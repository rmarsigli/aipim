#!/usr/bin/env node
"use strict";var _=Object.create;var I=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty;var q=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of H(t))!W.call(e,i)&&i!==o&&I(e,i,{get:()=>t[i],enumerable:!(n=z(t,i))||n.enumerable});return e};var r=(e,t,o)=>(o=e!=null?_(K(e)):{},q(t||!e||!e.__esModule?I(o,"default",{value:e,enumerable:!0}):o,e));var U=require("commander"),s=r(require("chalk"));var O=r(require("ora")),a=r(require("chalk"));var l=r(require("fs-extra")),u=r(require("path"));var E=r(require("fs-extra")),c=(e,t)=>e?.dependencies?.[t]||e?.devDependencies?.[t],v=e=>E.default.pathExistsSync(e),A=[{id:"astro",name:"Astro",template:"astro",check:e=>c(e,"astro")||v("astro.config.mjs")||v("astro.config.js")},{id:"nextjs",name:"Next.js",template:"nextjs",check:e=>c(e,"next")||v("next.config.js")},{id:"react-vite",name:"React (Vite)",template:"react",check:e=>c(e,"react")&&v("vite.config.js")},{id:"react-cra",name:"React (CRA)",template:"react",check:e=>c(e,"react")&&c(e,"react-scripts")},{id:"react",name:"React",template:"react",check:e=>c(e,"react")},{id:"vue",name:"Vue",template:"vue",check:e=>c(e,"vue")},{id:"svelte",name:"Svelte",template:"svelte",check:e=>c(e,"svelte")}],F={"pnpm-lock.yaml":"pnpm","yarn.lock":"yarn","package-lock.json":"npm","bun.lockb":"bun"},D=["CLAUDE.md","GEMINI.md","CHATGPT.md"];async function M(e=process.cwd()){let t=u.default.join(e,"package.json"),o=await l.default.pathExists(t)?await l.default.readJson(t):null,[n,i,m,p]=await Promise.all([l.default.pathExists(u.default.join(e,".git")),l.default.pathExists(u.default.join(e,"node_modules")),l.default.pathExists(u.default.join(e,".project")),J(e,D)]),{framework:g,frameworkVersion:y}=Y(o);return{framework:g,frameworkVersion:y,packageManager:await B(e),hasGit:n,hasNodeModules:i,existingSetup:{hasProject:m,hasPrompts:p}}}function Y(e){if(!e)return{framework:null,frameworkVersion:null};let t=A.find(n=>n.check(e));if(!t)return{framework:null,frameworkVersion:null};let o=S(e,t.id)||S(e,t.id.split("-")[0]);return{framework:t.id,frameworkVersion:o}}async function B(e){for(let[t,o]of Object.entries(F))if(await l.default.pathExists(u.default.join(e,t)))return o;return null}var S=(e,t)=>e?.dependencies?.[t]||e?.devDependencies?.[t];async function J(e,t){let o=[];for(let n of t)await l.default.pathExists(u.default.join(e,n))&&o.push(n);return o}var d=r(require("fs-extra")),w=r(require("path"));var C=r(require("fs-extra")),R=r(require("path"));async function G(e,t,o){let n=[];for(let p of t){let g=R.default.join(o,`guidelines/${p}.md`);if(await C.default.pathExists(g)){let y=await C.default.readFile(g,"utf-8");n.push(y)}}if(n.length===0)return e;let i=n.join(`

---

`);return e.replace(/{{SLOT:guidelines}}[\s\S]*?{{\/SLOT:guidelines}}/,`{{SLOT:guidelines}}

${i}

{{/SLOT:guidelines}}`)}async function L(e,t){let o=w.default.join(__dirname,"../../templates");await Q(o);for(let n of e.ais)await X(n,e,o);await ee()}async function Q(e){let t=w.default.join(e,"base/.project"),o=".project";await d.default.copy(t,o,{overwrite:!1,errorOnExist:!1});let n=["backlog","completed","decisions","docs","ideas","reports"];for(let i of n)await d.default.ensureDir(w.default.join(o,i))}async function X(e,t,o){let n=w.default.join(o,"base/project-manager.md"),i=await d.default.readFile(n,"utf-8");t.guidelines&&t.guidelines.length>0&&(i=await G(i,t.guidelines,o));let m=Z(e);await d.default.writeFile(m,i,"utf-8")}function Z(e){return{"claude-code":"CLAUDE.md","claude-ai":"CLAUDE.md",gemini:"GEMINI.md",chatgpt:"CHATGPT.md"}[e]||`${e.toUpperCase()}.md`}async function ee(){let e=[".project/scripts/pre-session.sh",".project/scripts/validate-dod.sh"];for(let t of e)await d.default.pathExists(t)&&await d.default.chmod(t,"755")}var k=r(require("inquirer")),f=r(require("chalk"));async function b(e,t={}){console.log(f.default.blue(`
\u{1F4CB} Installation Options
`));let{ais:o}=await k.default.prompt([{type:"checkbox",name:"ais",message:"Which AI tools will you use?",choices:[{name:"Claude Code (terminal AI assistant)",value:"claude-code",checked:!0},{name:"Claude.ai (web interface)",value:"claude-ai",checked:!0},{name:"Google Gemini",value:"gemini",checked:!1},{name:"ChatGPT",value:"chatgpt",checked:!1}],validate:p=>p.length<1?"You must choose at least one AI tool.":!0}]),n=[{name:"React",value:"react",checked:e.framework?.includes("react")},{name:"Astro",value:"astro",checked:e.framework==="astro"},{name:"Next.js",value:"nextjs",checked:e.framework==="nextjs"},{name:"Vue",value:"vue",checked:e.framework==="vue"}],{guidelines:i}=await k.default.prompt([{type:"checkbox",name:"guidelines",message:"Add framework-specific guidelines?",choices:n}]),{version:m}=await k.default.prompt([{type:"list",name:"version",message:"Choose system version:",choices:[{name:"Compact (1,000 tokens, optimized) [RECOMMENDED]",value:"compact",short:"Compact"},{name:"Full (4,000 tokens, comprehensive)",value:"full",short:"Full"}],default:"compact"}]);if(!t.yes){console.log(f.default.blue(`
\u{1F4C4} Installation Summary
`)),console.log("Files to be created:"),console.log(f.default.gray("  \u2022 .project/ (directory structure)"));let p=m==="compact"?"~1,000":"~4,000";o.forEach(x=>{let N=te(x);console.log(f.default.gray(`  \u2022 ${N} (${p} tokens${i.length>0?" + guidelines":""})`))});let g=e.existingSetup.hasPrompts;g.length>0&&(console.log(f.default.yellow(`
\u26A0\uFE0F  Warning: This will replace existing files:`)),g.forEach(x=>console.log(f.default.yellow(`   \u2022 ${x}`))));let{confirm:y}=await k.default.prompt([{type:"confirm",name:"confirm",message:"Proceed with installation?",default:!0}]);if(!y)return null}return{ais:o,guidelines:i,version:m,skipConfirmation:t.yes||!1}}function te(e){return{"claude-code":"CLAUDE.md","claude-ai":"CLAUDE.md",gemini:"GEMINI.md",chatgpt:"CHATGPT.md"}[e]||`${e.toUpperCase()}.md`}async function T(e={}){try{let t=(0,O.default)("Detecting project...").start(),o=await M();t.succeed("Project detected"),o.framework&&console.log(a.default.gray(`   \u2713 Found: ${o.framework} project`)),o.hasGit&&console.log(a.default.gray("   \u2713 Git repository: Yes")),o.packageManager&&console.log(a.default.gray(`   \u2713 Package manager: ${o.packageManager}`));let n;if(e.preset?(console.log(a.default.yellow(`
\u26A0\uFE0F  Preset feature coming soon, using interactive mode
`)),n=await b(o,e)):e.ai&&e.guidelines?n={ais:Array.isArray(e.ai)?e.ai:[e.ai],guidelines:Array.isArray(e.guidelines)?e.guidelines:[e.guidelines],version:e.full?"full":"compact",skipConfirmation:e.yes||!1}:n=await b(o,e),!n){console.log(a.default.red(`
\u274C Installation cancelled
`));return}t.start("Installing..."),await L(n,o),t.succeed("Installation complete!"),console.log(a.default.green(`
\u{1F389} Installation complete!
`)),console.log("Next steps:"),console.log(a.default.gray("  1. Run: .project/scripts/pre-session.sh")),console.log(a.default.gray("  2. Create first task: cp .project/_templates/v1/task-template.md .project/current-task.md")),console.log(a.default.gray(`  3. Start coding with AI!
`)),(n.ais.includes("claude-code")||n.ais.includes("claude-ai"))&&(console.log(a.default.blue("\u{1F4DA} Start your AI session with:")),console.log(a.default.blue(`   "Follow session start protocol and continue development"
`)))}catch(t){throw t}}var j=r(require("chalk"));async function $(e={}){console.log(j.default.yellow(`
\u26A0\uFE0F  Update command coming in v1.1!
`)),console.log("For now, to update:"),console.log(j.default.gray("  1. Backup your customizations")),console.log(j.default.gray("  2. Run: npx ia-project-manager install --yes")),console.log(j.default.gray(`  3. Restore your customizations
`))}var P="1.0.0";var h=new U.Command,V=`
 \u2588\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2557   \u2588\u2588\u2588\u2557
\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2588\u2551
\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255D\u2588\u2588\u2554\u2588\u2588\u2588\u2588\u2554\u2588\u2588\u2551
\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2551\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u2550\u255D \u2588\u2588\u2551\u255A\u2588\u2588\u2554\u255D\u2588\u2588\u2551
\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2551\u2588\u2588\u2551     \u2588\u2588\u2551 \u255A\u2550\u255D \u2588\u2588\u2551
\u255A\u2550\u255D  \u255A\u2550\u255D\u255A\u2550\u255D\u255A\u2550\u255D     \u255A\u2550\u255D     \u255A\u2550\u255D
`;h.name("ai-project-manager").description("AI-optimized project management system").version(P);h.command("install").description("Install AI Project Manager in current directory").option("-y, --yes","Skip confirmation prompts").option("-p, --preset <name>","Use preset configuration").option("--ai <ais...>","AI tools to use (claude-code, gemini, chatgpt)").option("--guidelines <frameworks...>","Framework guidelines (react, astro)").option("--compact","Use compact version (default)",!0).option("--full","Use full version").action(async e=>{console.log(s.default.blue(V)),console.log(s.default.blue(`AI Project Manager v${P}
`));try{await T(e)}catch(t){console.error(s.default.red(`
\u274C Error: ${t.message}
`)),process.exit(1)}});h.command("update").description("Update existing installation").option("-f, --force","Overwrite customizations").action(async e=>{console.log(s.default.blue(V)),console.log(s.default.blue(`AI Project Manager v${P}
`));try{await $(e)}catch(t){console.error(s.default.red(`
\u274C Error: ${t.message}
`)),process.exit(1)}});h.command("diff").description("Show what would change with update").action(async()=>{console.log(s.default.yellow(`
\u{1F50D} Diff command coming soon!
`))});h.command("validate").description("Validate current installation").action(async()=>{console.log(s.default.yellow(`
\u{1F50D} Validate command coming soon!
`))});h.parse(process.argv);process.argv.slice(2).length||h.outputHelp();
